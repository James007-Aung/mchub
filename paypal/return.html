<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="robots" content="noindex,nofollow" />
    <title>Redirecting…</title>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
        .btn { display:inline-block; padding:14px 18px; border-radius:8px; background:#229ED9; color:#fff; text-decoration:none; font-weight:600; }
        .hint { color:#444; margin-top:12px; }
    </style>
</head>
<body>
<h1 style="margin:0 0 8px 0;">Returning to Telegram…</h1>
<p class="hint">If Telegram doesn’t open automatically, tap the button below. If nothing happens, close this tab and switch back to Telegram manually.</p>

<p><a id="lnk" class="btn" href="#" rel="noopener">Open in Telegram</a></p>

<script>
    const qp   = new URLSearchParams(location.search);
    const tok  = qp.get('token') || '';
    const oid  = qp.get('oid')   || '';

    // Your REAL bot username (NO @)
    const BOT  = "thai_forms_helper_bot";

    const payload      = `ppcap_${encodeURIComponent(tok)}_${encodeURIComponent(oid)}`;
    const deeplinkWeb  = `https://t.me/${BOT}?start=${payload}`;
    const deeplinkApp  = `tg://resolve?domain=${BOT}&start=${encodeURIComponent(`ppcap_${tok}_${oid}`)}`;
    const intentUrl    = `intent://resolve?domain=${BOT}&start=${encodeURIComponent(`ppcap_${tok}_${oid}`)}#Intent;scheme=tg;package=org.telegram.messenger;S.browser_fallback_url=${encodeURIComponent(deeplinkWeb)};end`;

    const lnk = document.getElementById('lnk');
    lnk.href  = deeplinkWeb;

    // Progressive attempts; button stays visible as fallback
    function tryOpen() {
      let tried = false;
      const jump = (url, delay) => setTimeout(() => { tried = true; location.href = url; }, delay);
      // 1) tg:// (often works on Android)
      jump(deeplinkApp, 50);
      // 2) intent:// with fallback
      jump(intentUrl, 400);
      // 3) https://t.me (prompts to open Telegram)
      jump(deeplinkWeb, 900);
      // If user switches apps, this page will just remain in background (expected).
    }
    tryOpen();
</script>
</body>
</html>
