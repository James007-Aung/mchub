<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="robots" content="noindex,nofollow" />
    <title>Payment Cancelled</title>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
        .hint { color:#444; margin-top:12px; }
    </style>
</head>
<body>
<h1 style="margin:0 0 8px 0;">Payment was cancelled</h1>
<p class="hint">
    Taking you back to Telegramâ€¦
</p>

<script>
    const qp  = new URLSearchParams(location.search);
    const oid = qp.get('oid') || '';
    const BOT = "thai_forms_helper_bot"; // NO '@'

    // Deep-link payloads
    const ppcancel = `ppcancel_${oid}`;
    const deeplinkWeb = `https://t.me/${BOT}?start=${encodeURIComponent(ppcancel)}`;
    const deeplinkApp = `tg://resolve?domain=${BOT}&start=${encodeURIComponent(ppcancel)}`;
    const intentUrl   = `intent://resolve?domain=${BOT}&start=${encodeURIComponent(ppcancel)}#Intent;scheme=tg;package=org.telegram.messenger;S.browser_fallback_url=${encodeURIComponent(deeplinkWeb)};end`;

    // === Single-shot guard ===
    let fired = false;
    function navigateOnce(url) {
      if (fired) return;
      fired = true;
      location.replace(url);
      setTimeout(() => { try { location.replace('about:blank'); } catch(e){} }, 1500);
    }

    // Heuristic: prefer tg:// if supported; else intent on Android; else web t.me
    const ua = navigator.userAgent || '';
    const isAndroid = /Android/i.test(ua);
    const isTelegramInApp = /Telegram/i.test(ua);

    if (isAndroid && !isTelegramInApp) {
      navigateOnce(intentUrl);
    } else {
      navigateOnce(deeplinkApp);
    }
</script>

<p class="hint" style="margin-top:16px;">
    Not opening? <a id="manual" href="#">Open in Telegram</a>
</p>
<script>
    const manual = document.getElementById('manual');
    manual.href = deeplinkWeb;
</script>
</body>
</html>
